# Feature Pack: vault
# Password management and 2FA vault with team sharing, folders, TOTP, and SMS inbox

name: vault
title: Vault
description: Password management and 2FA vault with team sharing, folders, TOTP, and SMS inbox

routes:
  - path: /vault
    page: VaultLanding
    roles: []
    authz: { entity: vaults, verb: read }
  - path: /vault/setup
    page: VaultSetup
    roles: [admin]
    default_roles_allow: [admin]
    authz: { entity: setup, verb: read, require_action: vault.setup.access, show_pages: true }
  - path: /vault/items/[itemId]
    page: ItemDetail
    roles: []
    authz: { entity: items, verb: read }
  - path: /vault/items/[itemId]/edit
    page: ItemEdit
    roles: []
    authz: { entity: items, verb: write }

nav:
  - id: vault
    label: Vault
    path: /vault
    icon: Lock
    group: main
    showWhen: authenticated
    weight: 200
    children:
      - id: vault-dashboards
        label: Dashboard
        path: /dashboards/vault
        icon: LayoutDashboard
        weight: 0
        showWhen: authenticated
      - id: vault-main
        label: Vault
        path: /vault
        icon: Lock
        weight: 100
        showWhen: authenticated
      - id: vault-setup
        label: Setup
        path: /vault/setup
        icon: Settings
        weight: 120
        showWhen: authenticated
        roles: [admin]

schema:
  source: src/schema/vault.ts
  exports:
    - vaultTypeEnum
    - itemTypeEnum
    - principalTypeEnum
    - smsStatusEnum
    - auditActionEnum
    - vaultVaults
    - vaultFolders
    - vaultItems
    - vaultAcls
    - vaultStaticGroups
    - vaultGroupMembers
    - vaultSmsNumbers
    - vaultSmsMessages
    - vaultSettings
    - vaultWebhookLogs
    - vaultAuditEvents
    - vaultVaultsRelations
    - vaultFoldersRelations
    - vaultItemsRelations
    - vaultStaticGroupsRelations
    - vaultGroupMembersRelations
    - vaultSmsNumbersRelations
    - vaultSmsMessagesRelations
    - VAULT_PERMISSIONS
    - VaultPermission

api:
  routes:
    # Vaults
    - path: /api/vault/vaults
      methods: [GET, POST]
      handler: "@hit/feature-pack-vault/server/api/vaults"
      description: "List vaults (GET) or create shared vault (POST)"
    - path: /api/vault/vaults/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-vault/server/api/vaults-id"
      description: "Get, update, or delete a vault"
    # Folders
    - path: /api/vault/folders
      methods: [GET, POST]
      handler: "@hit/feature-pack-vault/server/api/folders"
      description: "List folders (GET) or create folder (POST)"
    - path: /api/vault/folders/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-vault/server/api/folders-id"
      description: "Get, update, or delete a folder"
    - path: /api/vault/folders/[id]/move
      methods: [POST]
      handler: "@hit/feature-pack-vault/server/api/folders-move"
      description: "Move folder to new parent"
    # Items
    - path: /api/vault/items
      methods: [GET, POST]
      handler: "@hit/feature-pack-vault/server/api/items"
      description: "List items (GET) or create item (POST)"
    - path: /api/vault/items/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-vault/server/api/items-id"
      description: "Get, update, or delete an item"
    - path: /api/vault/items/[id]/reveal
      methods: [POST]
      handler: "@hit/feature-pack-vault/server/api/items-reveal"
      description: "Reveal decrypted password/secret (audited)"
    - path: /api/vault/items/[id]/copy
      methods: [POST]
      handler: "@hit/feature-pack-vault/server/api/items-copy"
      description: "Copy password to clipboard (audited)"
    - path: /api/vault/items/[id]/move
      methods: [POST]
      handler: "@hit/feature-pack-vault/server/api/items-move"
      description: "Move item to new folder"
    # Sharing/ACL
    - path: /api/vault/acl
      methods: [GET, POST]
      handler: "@hit/feature-pack-vault/server/api/acl"
      description: "List ACLs (GET) or create ACL entry (POST)"
    - path: /api/vault/acl/[id]
      methods: [DELETE]
      handler: "@hit/feature-pack-vault/server/api/acl-id"
      description: "Delete ACL entry"

requires:
  modules: [auth]

dependencies:
  feature_packs:
    - name: erp-shell-core

# ─────────────────────────────────────────────────────────────────────────────
# METRICS
#
# Metric definitions are schema-driven and live under:
#   schema/metrics/definitions/*.yaml
# ─────────────────────────────────────────────────────────────────────────────

# ─────────────────────────────────────────────────────────────────────────────
# PERMISSIONS
# ─────────────────────────────────────────────────────────────────────────────
# Permissions are schema-driven and live under:
#   schema/permissions.yaml

